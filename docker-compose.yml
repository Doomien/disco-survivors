services:
  disco-survivors:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: disco-survivors-game
    ports:
      - "0.0.0.0:3333:80"
    restart: unless-stopped
    depends_on:
      - api
    volumes:
      # Mount files for live updates (no rebuild needed!)
      - ./characters.json:/usr/share/nginx/html/characters.json
      - ./config:/usr/share/nginx/html/config
      - ./assets:/usr/share/nginx/html/assets
      - ./game.js:/usr/share/nginx/html/game.js
      - ./tools:/usr/share/nginx/html/tools
      - ./index.html:/usr/share/nginx/html/index.html
    networks:
      - disco-net
    labels:
      - "com.disco-survivors.description=Disco Survivors Game"
      - "com.disco-survivors.version=2.0"

  api:
    build:
      context: ./api
      dockerfile: Dockerfile
    container_name: disco-survivors-api
    ports:
      - "0.0.0.0:3334:3334"
    environment:
      - NODE_ENV=production
      - PORT=3334
      - CHARACTERS_FILE=/data/characters.json
      - ENEMIES_CONFIG=/data/config/base/enemies.json
      - CUSTOM_ENEMIES_CONFIG=/data/config/custom/enemies.json
      - BACKUP_DIR=/data/backups
      - ASSETS_DIR=/data/assets
      - CONFIG_DIR=/data/config
      - LOG_LEVEL=info
      - CORS_ORIGIN=*
    volumes:
      - ./characters.json:/data/characters.json
      - ./config:/data/config
      - ./backups:/data/backups
      - ./assets:/data/assets
    restart: unless-stopped
    networks:
      - disco-net
    labels:
      - "com.disco-survivors.description=Disco Survivors API"
      - "com.disco-survivors.version=2.0"

networks:
  disco-net:
    driver: bridge
